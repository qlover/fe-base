# é¡¹ç›®æ„å»ºä¸ä¾èµ–ç®¡ç†æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç» fe-base é¡¹ç›®çš„æ„å»ºç³»ç»Ÿå’Œä¾èµ–ç®¡ç†ã€‚

## ğŸ“‹ ç›®å½•

- [æ„å»ºç³»ç»Ÿæ¦‚è¿°](#æ„å»ºç³»ç»Ÿæ¦‚è¿°)
- [pnpm Workspace ç®¡ç†](#-pnpm-workspace-ç®¡ç†)
- [æ„å»ºå‘½ä»¤è¯¦è§£](#-æ„å»ºå‘½ä»¤è¯¦è§£)
- [ä¾èµ–ç®¡ç†ç­–ç•¥](#-ä¾èµ–ç®¡ç†ç­–ç•¥)
- [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)

## æ„å»ºç³»ç»Ÿæ¦‚è¿°

fe-base é‡‡ç”¨ **monorepo** æ¶æ„ï¼Œå³åœ¨ä¸€ä¸ªä»“åº“ä¸­ç®¡ç†å¤šä¸ªç›¸å…³çš„åŒ…ã€‚è¿™ç§æ¶æ„çš„ä¼˜åŠ¿ï¼š

- **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰åŒ…ä½¿ç”¨ç›¸åŒçš„æ„å»ºå·¥å…·å’Œé…ç½®
- **ä¾èµ–å…±äº«**ï¼šåŒ…ä¹‹é—´å¯ä»¥ç›´æ¥å¼•ç”¨ï¼Œæ— éœ€å‘å¸ƒåˆ° npm
- **ç‰ˆæœ¬åŒæ­¥**ï¼šå¯ä»¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰åŒ…çš„ç‰ˆæœ¬å‘å¸ƒ

### ä¸»è¦æŠ€æœ¯æ ˆ

| å·¥å…· | ä½œç”¨ | ç‰ˆæœ¬ |
|------|------|------|
| **pnpm** | åŒ…ç®¡ç†å™¨ï¼Œæ”¯æŒ workspace | >= 8.0.0 |
| **nx** | æ„å»ºç³»ç»Ÿï¼Œä»»åŠ¡ç¼–æ’å’Œç¼“å­˜ | 20.6.4 |
| **tsup** | TypeScript æ„å»ºå·¥å…· | ^8.4.0 |
| **rollup** | æ¨¡å—æ‰“åŒ…å·¥å…· | ^4.24.2 |
| **TypeScript** | ç±»å‹ç³»ç»Ÿ | ~5.4.5 |
| **Vite** | å¼€å‘æœåŠ¡å™¨å’Œæ„å»ºå·¥å…· | ^6.1.0 |

### ä¸ºä»€ä¹ˆé€‰æ‹©è¿™äº›å·¥å…·ï¼Ÿ

- **pnpm**: ç›¸æ¯” npm/yarnï¼ŒèŠ‚çœç£ç›˜ç©ºé—´ï¼Œæ”¯æŒ workspace åŠŸèƒ½
- **nx**: æä¾›å¢é‡æ„å»ºå’Œç¼“å­˜ï¼Œå¤§å¹…æå‡æ„å»ºé€Ÿåº¦
- **tsup**: åŸºäº esbuildï¼Œæ„å»ºé€Ÿåº¦å¿«ï¼Œé…ç½®ç®€å•
- **rollup**: ä¸“ä¸šçš„æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼
- **TypeScript**: æä¾›ç±»å‹å®‰å…¨ï¼Œæå‡ä»£ç è´¨é‡
- **Vite**: ç°ä»£åŒ–çš„å¼€å‘å·¥å…·ï¼Œçƒ­æ›´æ–°å¿«

## ğŸ“¦ pnpm Workspace ç®¡ç†

### Workspace é…ç½®

```yaml
# pnpm-workspace.yaml
packages:
  - packages/*
```

è¿™ä¸ªé…ç½®å‘Šè¯‰ pnpmï¼Œ`packages/` ç›®å½•ä¸‹çš„æ¯ä¸ªå­ç›®å½•éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åŒ…ã€‚

### é€’å½’æ„å»ºæœºåˆ¶

pnpm çš„é€’å½’æ¨¡å¼èƒ½å¤Ÿè‡ªåŠ¨æŒ‰ä¾èµ–é¡ºåºæ‰§è¡Œæ„å»ºï¼š

```bash
# é€’å½’æ„å»ºæ‰€æœ‰åŒ…
pnpm -r run build
```

**ä¸ºä»€ä¹ˆéœ€è¦é€’å½’æ„å»ºï¼Ÿ**
- åŒ…ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå¿…é¡»æŒ‰æ­£ç¡®é¡ºåºæ„å»º
- å¦‚æœåŒ… A ä¾èµ–åŒ… Bï¼Œé‚£ä¹ˆå¿…é¡»å…ˆæ„å»ºåŒ… Bï¼Œå†æ„å»ºåŒ… A
- pnpm ä¼šè‡ªåŠ¨åˆ†æä¾èµ–å…³ç³»ï¼Œç¡®ä¿æ„å»ºé¡ºåºæ­£ç¡®

### workspace:* ä¾èµ–æœºåˆ¶

æœ¬åœ°åŒ…ä¾èµ–ä½¿ç”¨ `workspace:*`ï¼š

```json
{
  "dependencies": {
    "@qlover/fe-corekit": "workspace:*"
  }
}
```

**workspace:* çš„å·¥ä½œåŸç†ï¼š**
1. **å¼€å‘é˜¶æ®µ**ï¼špnpm åˆ›å»ºè½¯é“¾æ¥æŒ‡å‘æœ¬åœ°åŒ…
2. **å‘å¸ƒé˜¶æ®µ**ï¼šè‡ªåŠ¨æ›¿æ¢ä¸ºå…·ä½“ç‰ˆæœ¬å·ï¼ˆå¦‚ `^1.2.3`ï¼‰
3. **å®æ—¶åŒæ­¥**ï¼šæœ¬åœ°åŒ…çš„ä¿®æ”¹ä¼šç«‹å³åæ˜ åˆ°ä¾èµ–æ–¹

**é‡è¦**ï¼šå®‰è£…ä¾èµ–åå¿…é¡»ç«‹å³æ„å»ºï¼Œå› ä¸ºæœ¬åœ°åŒ…éœ€è¦æ„å»ºäº§ç‰©ï¼š

```bash
# âŒ é”™è¯¯ï¼šåªå®‰è£…ä¾èµ–ï¼Œä¸æ„å»º
pnpm install

# âœ… æ­£ç¡®ï¼šå®‰è£…åç«‹å³æ„å»º
pnpm install && pnpm build
```

**ä¸ºä»€ä¹ˆå¿…é¡»æ„å»ºï¼Ÿ**
- TypeScript æºç éœ€è¦ç¼–è¯‘æˆ JavaScript
- å…¶ä»–åŒ…å¼•ç”¨çš„æ˜¯ `dist/` ç›®å½•ä¸‹çš„æ„å»ºäº§ç‰©ï¼Œä¸æ˜¯ `src/` æºç 
- æ²¡æœ‰æ„å»ºäº§ç‰©ä¼šå¯¼è‡´ "æ‰¾ä¸åˆ°æ¨¡å—" é”™è¯¯

## ğŸ”§ æ„å»ºå‘½ä»¤è¯¦è§£

### ä¸»è¦æ„å»ºå‘½ä»¤

```bash
# å®Œæ•´æ„å»ºæ‰€æœ‰åŒ…ï¼ˆæ¨èï¼‰
pnpm build

# å¢é‡æ„å»ºï¼ˆä»…æ„å»ºå˜æ›´çš„åŒ…ï¼‰
pnpm nx:build

# æ¸…ç†æ„å»ºäº§ç‰©
pnpm clean:build

# æ„å»ºç‰¹å®šåŒ…
pnpm --filter @qlover/fe-corekit build
pnpm --filter @qlover/fe-scripts build
```

### æ„å»ºè„šæœ¬è¯´æ˜

```json
{
  "scripts": {
    "build": "pnpm -r --workspace-concurrency=4 run build && pnpm rebuild",
    "nx:build": "nx affected:build",
    "clean:build": "fe-clean -f packages/*/dist -r",
    "build:fe-release": "pnpm --filter @qlover/fe-release build",
    "build:logger": "pnpm --filter @qlover/logger build"
  }
}
```

**å„å‘½ä»¤çš„ä½œç”¨ï¼š**
- `pnpm build`: å¹¶å‘æ„å»ºæ‰€æœ‰åŒ…ï¼Œç„¶åé‡å»ºç¡®ä¿ä¾èµ–æ­£ç¡®
- `pnpm nx:build`: ä½¿ç”¨ nx å¢é‡æ„å»ºï¼Œåªæ„å»ºå˜æ›´çš„åŒ…
- `pnpm clean:build`: æ¸…ç†æ‰€æœ‰åŒ…çš„ dist ç›®å½•
- `pnpm build:fe-release`: å•ç‹¬æ„å»ºå‘å¸ƒå·¥å…·
- `pnpm build:logger`: å•ç‹¬æ„å»ºæ—¥å¿—å·¥å…·

**ä¸ºä»€ä¹ˆéœ€è¦ `pnpm rebuild`ï¼Ÿ**
- ç¡®ä¿æ‰€æœ‰åŒ…çš„ä¾èµ–å…³ç³»éƒ½æ˜¯æœ€æ–°çš„
- é‡æ–°é“¾æ¥æœ¬åœ°åŒ…çš„ä¾èµ–
- è§£å†³å¯èƒ½çš„ä¾èµ–ç¼“å­˜é—®é¢˜

**ä»€ä¹ˆæ—¶å€™ç”¨å¢é‡æ„å»ºï¼Ÿ**
- å¼€å‘é˜¶æ®µï¼Œåªæƒ³æ„å»ºä¿®æ”¹è¿‡çš„åŒ…
- å¤§å‹é¡¹ç›®ä¸­ï¼Œå…¨é‡æ„å»ºè€—æ—¶è¾ƒé•¿
- CI/CD ä¸­ï¼Œåªæ„å»ºå—å½±å“çš„åŒ…

## ğŸ”— ä¾èµ–ç®¡ç†ç­–ç•¥

### ä¾èµ–ç±»å‹

1. **æœ¬åœ°åŒ…ä¾èµ–**ï¼šä½¿ç”¨ `workspace:*`
   ```json
   {
     "dependencies": {
       "@qlover/fe-corekit": "workspace:*",
       "@qlover/logger": "workspace:*",
       "@qlover/env-loader": "workspace:*"
     }
   }
   ```
   **ç”¨é€”**ï¼šå¼•ç”¨åŒä¸€ä»“åº“ä¸­çš„å…¶ä»–åŒ…

2. **å¤–éƒ¨åŒ…ä¾èµ–**ï¼šä½¿ç”¨å…·ä½“ç‰ˆæœ¬
   ```json
   {
     "dependencies": {
       "lodash": "^4.17.21",
       "commander": "^11.0.0"
     }
   }
   ```
   **ç”¨é€”**ï¼šå¼•ç”¨ npm ä¸Šçš„ç¬¬ä¸‰æ–¹åŒ…

3. **å¼€å‘ä¾èµ–**ï¼šæ„å»ºå’Œæµ‹è¯•å·¥å…·
   ```json
   {
     "devDependencies": {
       "typescript": "~5.4.5",
       "tsup": "^8.4.0",
       "@qlover/env-loader": "workspace:*"
     }
   }
   ```
   **ç”¨é€”**ï¼šåªåœ¨å¼€å‘å’Œæ„å»ºæ—¶éœ€è¦ï¼Œä¸ä¼šæ‰“åŒ…åˆ°æœ€ç»ˆäº§ç‰©

### æ¨èçš„å®‰è£…æµç¨‹

```bash
# 1. å®‰è£…ä¾èµ–
pnpm install

# 2. ç«‹å³æ„å»ºï¼ˆé‡è¦ï¼ï¼‰
pnpm build

# 3. éªŒè¯æ„å»º
pnpm test
```

**ä¸ºä»€ä¹ˆè¦æŒ‰è¿™ä¸ªé¡ºåºï¼Ÿ**
1. **å…ˆå®‰è£…**ï¼šç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½å·²ä¸‹è½½
2. **å†æ„å»º**ï¼šç”Ÿæˆå…¶ä»–åŒ…éœ€è¦çš„æ„å»ºäº§ç‰©
3. **æœ€åæµ‹è¯•**ï¼šéªŒè¯æ‰€æœ‰åŒ…éƒ½èƒ½æ­£å¸¸å·¥ä½œ

## â“ å¸¸è§é—®é¢˜

### 1. ä¾èµ–æ‰¾ä¸åˆ°æ¨¡å—

**é—®é¢˜**ï¼š`Error: Cannot find module '@qlover/fe-corekit'`

**åŸå› **ï¼šè¢«ä¾èµ–çš„åŒ…æ²¡æœ‰æ„å»ºï¼Œç¼ºå°‘ `dist/` ç›®å½•

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ä¾èµ–åŒ…æ˜¯å¦å·²æ„å»º
ls packages/fe-corekit/dist/

# é‡æ–°æ„å»ºä¾èµ–åŒ…
pnpm --filter @qlover/fe-corekit build

# æˆ–é‡æ–°æ„å»ºæ‰€æœ‰åŒ…
pnpm build
```

### 2. ç±»å‹å®šä¹‰ç¼ºå¤±

**é—®é¢˜**ï¼š`TS2307: Cannot find module '@qlover/logger'`

**åŸå› **ï¼šTypeScript æ‰¾ä¸åˆ°ç±»å‹å®šä¹‰æ–‡ä»¶ï¼ˆ`.d.ts`ï¼‰

**è§£å†³**ï¼š
```bash
# é‡æ–°ç”Ÿæˆç±»å‹å®šä¹‰
pnpm --filter @qlover/logger build
```

### 3. æ„å»ºç¼“å­˜é—®é¢˜

**é—®é¢˜**ï¼šä¿®æ”¹ä»£ç åæ„å»ºäº§ç‰©æ²¡æœ‰æ›´æ–°

**åŸå› **ï¼šæ„å»ºå·¥å…·ä½¿ç”¨äº†ç¼“å­˜ï¼Œæ²¡æœ‰æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–

**è§£å†³**ï¼š
```bash
# æ¸…ç†æ„å»ºç¼“å­˜
pnpm clean:build && pnpm build

# æ¸…ç† nx ç¼“å­˜
nx reset
```

### 4. ä¾èµ–ç‰ˆæœ¬å†²çª

**åŸå› **ï¼šä¸åŒåŒ…ä¾èµ–äº†åŒä¸€ä¸ªåº“çš„ä¸åŒç‰ˆæœ¬

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ä¾èµ–æ ‘
pnpm list --filter @qlover/fe-corekit

# æ£€æŸ¥ä¸ºä»€ä¹ˆå®‰è£…äº†æŸä¸ªåŒ…
pnpm why package-name

# é‡æ–°å®‰è£…
rm -rf node_modules && pnpm install
```

## ğŸ¯ æœ€ä½³å®è·µ

### å¼€å‘å·¥ä½œæµ

1. **åˆå§‹åŒ–é¡¹ç›®**ï¼š
   ```bash
   pnpm install && pnpm build  # å®‰è£…ä¾èµ–å¹¶æ„å»º
   ```

2. **æ—¥å¸¸å¼€å‘**ï¼š
   ```bash
   pnpm nx:build              # å¢é‡æ„å»ºå˜æ›´çš„åŒ…
   pnpm test                  # è¿è¡Œæµ‹è¯•
   ```

3. **ç›‘å¬æ¨¡å¼å¼€å‘**ï¼š
   ```bash
   cd packages/fe-corekit
   pnpm dev  # å¯åŠ¨ç›‘å¬æ¨¡å¼ï¼Œæ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°æ„å»º
   ```

4. **æäº¤å‰æ£€æŸ¥**ï¼š
   ```bash
   pnpm lint && pnpm build && pnpm test
   ```

### ä¸ºä»€ä¹ˆè¦éµå¾ªè¿™ä¸ªå·¥ä½œæµï¼Ÿ

- **åˆå§‹åŒ–**ï¼šç¡®ä¿ç¯å¢ƒæ­£ç¡®ï¼Œæ‰€æœ‰ä¾èµ–éƒ½èƒ½æ­£å¸¸å·¥ä½œ
- **å¢é‡æ„å»º**ï¼šæé«˜å¼€å‘æ•ˆç‡ï¼Œé¿å…ä¸å¿…è¦çš„é‡å¤æ„å»º
- **ç›‘å¬æ¨¡å¼**ï¼šå®æ—¶åé¦ˆï¼Œæå‡å¼€å‘ä½“éªŒ
- **æäº¤å‰æ£€æŸ¥**ï¼šç¡®ä¿ä»£ç è´¨é‡ï¼Œé¿å…ç ´åæ€§å˜æ›´

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¦‚ä½•å¢åŠ ä¸€ä¸ªå­åŒ…](./how-to-add-a-subpackage.md)
- [æµ‹è¯•æŒ‡å—](./testing-guide.md)
- [æ‰“åŒ…æ ¼å¼æŒ‡å—](./build-formats.md)
- [é¡¹ç›®å‘å¸ƒ](./project-release.md)
